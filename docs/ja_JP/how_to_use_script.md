# Script（シーンスクリプト）

> [!IMPORTANT]
> この文書はテキスト大規模モデルDeepSeekによって中国語から日本語へ翻訳されました

---

## 定義

**シーンスクリプトファイル**は、シーン変更を制御するための```.reg```拡張子のテキストファイルです。背景画像、字幕テキスト、音声、BGMなどの再生と切り替えを制御し、エンジンにいつどの背景を表示し、どのキャラクターを表示し、どの台詞を再生するかを指示します。コンテンツ全体の核となるものです。

---

## ドキュメント

> [!WARNING]
> エンコーディングエラーを避けるため、スクリプトファイルのエンコーディングは```UTF-8```に統一してください！

スクリプトは、先頭の**ヘッダーブロック**と複数の**ストーリーブロック**で構成されます。**ブロック**は空行で区切られます。

行頭に```#```を使用してコメントを記述できます。エンジンはスクリプト読み込み時にこれらの行を無視します。

---

### ヘッダーブロック

**ヘッダーブロック**は、スクリプトの関連情報を記録し、エンジンがスクリプトを読み込んで対応する操作を行うために使用します。

**最初の行**は```プロトコルバージョン```で、異なるバージョンスタンダードのスクリプトを区別するために使用します。形式は```%version X```で、```X```は整数であり、現在のスクリプトのプロトコルバージョンを表します。

---

### ストーリーブロック

**ストーリーブロック**は、ストーリー全体の展開と現在のシーン変更を記録します。複数の行で構成され、各行には一つの**操作**が含まれ、**操作**はシーン変更を制御するために使用されます。

以下は各種操作とその使用方法です：

* #### 背景画像：

* * ```@bg bg1|0.1|0.2|1.5```：```@bg```は背景画像を再生する識別子です（```@cg```も使用可能、機能は同じですがスクリプト上で区別するため）。**縦棒**```|```で各部分を分割します：

* * ```bg1```は背景画像として使用するpng画像ファイルで、ルートディレクトリの```source/background```フォルダに配置する必要があります。

* * ```0.1|0.2|1.5```はそれぞれx座標、y座標、拡大率で、背景画像の位置とサイズをカスタマイズするために使用します。これらは**すべて空にすることができます**（```|```はすべて空の場合**削除可能**）。

* * ```@cg```を使用することもできます。機能は同じです。CGを使用する際の背景画像は、CG鑑賞および設定ファイルに記録する必要があります。詳細な使用方法については、[設定ファイルドキュメント](how_to_use_config.md)を参照してください。

* #### BGM：

* * ```@bgm bgm2```：```@bgm```は背景音楽を再生する識別子です。```bgm2```は背景音楽として使用するogg音声ファイルで、ルートディレクトリの```source/bgm```フォルダに配置する必要があります。

* #### 音声：

* * ```@voice rir|fem_rir_3```：```@voice```は台詞の音声を再生する識別子です。**縦棒**```|```で各部分を分割します：

* * ```rir```はキャラクター名です。

* * ```fem_rir_3```は台詞の音声として使用するogg音声ファイルで、ルートディレクトリの```source/voice```フォルダに配置する必要があります。

* #### 字幕：

* * ```ナレーター“壬戌之秋、{nns}七月既望”```：この操作は**中国語の二重引用符**```“”```によって2つの部分に区切られます：

* * 前半は表示する話者名、後半（二重引用符内）は脚本の字幕です。話者名は省略可能です。

* * ```{nns}```はテキストの改行を指定できます（最大**3行**まで表示）。

* #### 立ち絵と表情：

* * ```@fg rir|z1|rir_z1b0200|b0059|0|1000```：```@fg```は立ち絵を表示する識別子です。**縦棒**```|```で各部分を分割します：

* * ```rir```はキャラクター名です。

* * ```z1```は立ち絵の遠近関係（zオーダー）です。

* * ```rir_z1b0200```は立ち絵の身体部分のpng画像ファイルです。

* * ```b0059```は立ち絵の表情のpng画像ファイルです。

* * ```0```は立ち絵の位置を表します（左から右に、-2、-1、0、1、2）。

* * ```1000```は遅延時間（ミリ秒）で、この操作を指定ミリ秒だけ**遅延**できます。遅延は**空にすることができます**（```|```は空の場合**削除可能**）。

* * 立ち絵の詳細な設計と使用方法については、[設定ファイルドキュメント](how_to_use_config.md)を参照してください。

* #### アニメーション：

* * ```@move rar|z1|rar_z1a0200|z1a0041|-2|nod|3|4200```：```@move```はアニメーションを表示する識別子です。**縦棒**```|```で各部分を分割します：

* * 最初のいくつかの部分は、アニメーションを適用する立ち絵と**一致させる必要があります**。

* * ```nod```はうなずく動作を表します。他にも```tox```動作があります（xは位置で、立ち絵を移動させます。例：```to2```）。

* * ```3```は動作のループ回数を表します。-1は無限ループです。

* * ```4200```は遅延時間（ミリ秒）で、この操作を指定ミリ秒だけ**遅延**できます。遅延は**空にすることができます**（```|```は空の場合**削除可能**）。

* #### ラベル：

* * ```@label test```：```@label```はラベル操作の識別子です。その後ろがラベル名です。**同一**スクリプト内でラベル名は**重複できません**。選択肢とジャンプに使用できます。

* #### ジャンプ：

* * ```@jump ky01:start```：```@jump```はジャンプ操作の識別子です。**コロン**```:```で構造を分割します：

* * ```ky01```はスクリプトファイル名、```start```はラベル名です。

* * スクリプトファイル名が**空**の場合（**コロン**は必要）、**現在のスクリプト**のラベルにジャンプします。

* * ラベル名が**空**の場合、**指定されたスクリプト**の```start```ラベルにジャンプします。

* #### 選択肢：

* * ```
    @choose 3
    test
    選択肢1 :start
    選択肢2 ky02
    選択肢3 ky01:test
    ```
* * ```@choose```は選択操作の識別子です。その後ろの数字```3```はこの分岐の選択肢の数です。```test```はこの選択肢の名前で、カスタマイズ可能であり、履歴とセーブデータ表示に使用されます。以下の数行が選択内容で、前のテキストは選択肢の説明、後ろはジャンプロジックで、```jump```操作のロジックと**一致します**。
