# Script（场景脚本）

## 定义

**场景脚本文件**是用于控制场景变化的以```.reg```作为后缀的文本文件，能够控制背景图片、字幕文本、配音音频、BGM音频等等的播放及更换，用于向引擎标识什么时候该放什么背景、显示哪个人物、播放哪一句台词等等，可以说是整个内容的核心。

## 文档

**为了避免可能的编码错误问题，我统一们规定要求脚本文件的编码为```UTF-8```！**

一个脚本由一个位于开头**标识块**和若干**剧情块**组成。**块**之间由一行空行分隔。

每一行的开头可以使用```#```作为注释标识符，引擎在读取脚本时会忽略该行。

### 标识块

**标识块**用于记录该脚本的相关信息，以便引擎读取并对脚本做出对应的操作。

其中**第一行**为```协议版本```，用于区分不同版本标准的脚本。其格式为```%version X```，其中```X```为一个整数，表示当前脚本的协议版本。

### 剧情块

**剧情块**用于记录整个故事的剧情发展以及当下的场景变换，由若干行组成，每一行都包含一条**操作**，**操作**用来控制场景变化。

以下是各种操作以及对应的用法：

#### 播放背景图片：

```@bg bg1```：其中```@bg```为播放背景图片的标识符，```bg1```为用作背景图片的png图片文件，该文件应该被放置在根目录的```source/background```文件夹下。

#### 播放背景音乐：

```@bgm bgm2```：其中```@bgm```为播放背景音乐的标识符，```bgm2```为用作背景音乐的ogg音频文件，该文件应该被放置在根目录的```source/bgm```文件夹下。

#### 播放台词配音：

```@voice fem_rir_3```：其中```@voice```为播放台词配音的标识符，```fem_rir_3```为用作台词配音的ogg音频文件，该文件应该被放置在根目录的```source/voice```文件夹下。

#### 播放台词字幕：

```旁白“壬戌之秋，七月既望”```：该条操作由**中文双引号**```“”```分隔成两部分，前半部分为显示的说话者名称，后半部分（中文双引号内部分）为台词字幕，可以不添加说话者。

#### 播放立绘及表情：

```@fg rir|z1|rir_z1b0200|b0059|0|1000```：其中```@fg```为显示立绘的标识符，用**竖线**```|```分割各个部分，其中```rir```是角色名字,```z1```是立绘的远近关系，```rir_z1b0200```是立绘身体的png图片文件，```b0059```是立绘表情的png图片文件，```0```代表立绘位置（从左到右，分别为-2，-1，0，1，2），```1000```为delay延时，可以将此操作**延后**指定毫秒。立绘身体标识可以**为空**（```|```**不可删除**），此时只改变表情，不改变身体；延时也可**为空**（```|```**可删除**）。

关于立绘的具体设计与使用，请查阅[配置文件文档](how_to_use_config.md)

#### 标签：

```@label test```：其中```@label```为标签操作的标识符，后面是标签名称，**同一**脚本内标签名称**不可重复**，可用作选择与跳转。

#### 跳转：

```@jump ky01:start```：其中```@jump```为跳转操作的标识符，用**英文冒号**划分结构，前者是脚本文件，后者是标签名。脚本文件**为空**时（需保留**冒号**），自动跳转至**本脚本**的标签；标签名**为空**时，自动跳转至**所指脚本**的```start```标签。

#### 选择支：

```
@choose 3
test
选择1 :start
选择2 ky02
选择3 ky01:test
```
```@choose```为选择操作的标识符，后面的数字为该分支的选择数量。```test```为该选择支的名字，可以自定义，用作履历以及存档显示。下面数行是选择内容，前面的文本为选择支的描述，后面是跳转逻辑，与```jump```操作的逻辑**一致**。